<main id = "main">
<div id ="content">
    <nav id = "nav_sub">
        <ul>
            <li><a href="#">Photo</a></li>
        </ul>
    </nav>
    <h2 class="title">Photo add Text</h2>
    <div class="containers center">
        <form>
            <label for="fileInput">Upload a photo:</label>
            <input type="file" id="fileInput" accept="image/*"><br>
            <label for="textInput">Enter the text to be added:</label>
            <textarea id="textInput"></textarea>
            <label for="fontStyleInput">Choose Font Style:</label>
            <select class="browser-default" id="fontStyleInput">
                <option value="Arial">Arial</option>
                <option value="Helvetica">Helvetica</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Courier New">Courier New</option>
                <option value="Verdana">Verdana</option>
                <option value="Georgia">Georgia</option>
                <option value="Comic Sans MS">Comic Sans MS</option>
                <option value="Impact">Impact</option>
            </select>
            <label for="fontSizeInput">Choose Font Size:</label>
            <input type="number" id="fontSizeInput" min="1" max="500" value="100">
            <label for="colorInput">Text color:</label>
            <select class="browser-default" id="colorInput">
                <option value="custom">Others</option>
                <option value="#000000" style="background-color: #000000;">Black</option>
                <option value="#ffffff" style="background-color: #ffffff;">White</option>
                <option value="#ff0000" style="background-color: #ff0000;">Red</option>
                <option value="#ffa500" style="background-color: #ffa500;">Orange</option>
                <option value="#ffff00" style="background-color: #ffff00;">Yellow</option>
                <option value="#008000" style="background-color: #008000;">Dark Green</option>
                <option value="#008000" style="background-color: #00ff00;">Green</option>
                <option value="#0000ff" style="background-color: #0000ff;">Blue</option>
                <option value="#4b0082" style="background-color: #4b0082;">Indigo</option>
                <option value="#a0a0a0" style="background-color: #a0a0a0;">Grey</option>

            </select>
            <label for="customColorInput">Other Colors:</label>
            <input type="color" id="customColorInput" value="#ffffff"><br>
            <button class="btn blue" type="button" onclick="merge()">Merge</button>
        </form>
    </div>
    <br>
    <canvas id="canvas"></canvas>
    <script>
        var title_ = document.querySelector(".title");
        var title_id = title_.getAttribute('id');
        if (title_id === null){
            let canvas = document.getElementById("canvas");
            let ctx = canvas.getContext("2d");
            let img, text, fontSize, fontColor, fontStyle;

            fontSize = 100

            function merge() {
                if (img && text) {
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    ctx.font = fontSize  + "px " + fontStyle;
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    ctx.fillStyle = fontColor;
                    ctx.fillText(text, canvas.width / 2, canvas.height / 2);
                }
            }

            function setFontStyle() {
                fontStyle = document.getElementById("fontStyleInput").value;
            }

            document.getElementById("fileInput").addEventListener("change", function () {
                img = new Image();
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                };
                img.src = URL.createObjectURL(this.files[0]);
            });

            document.getElementById("textInput").addEventListener("input", function () {
                text = this.value;
            });

            document.getElementById("fontSizeInput").addEventListener("input", function () {
                fontSize = parseInt(this.value);
            });

            document.getElementById("colorInput").addEventListener("change", function () {
                if (this.value === "custom") {
                    document.getElementById("customColorInput").style.display = "block";
                    fontColor = document.getElementById("customColorInput").value;
                } else {
                    document.getElementById("customColorInput").style.display = "none";
                    fontColor = this.value;
                }
            });

            document.getElementById("customColorInput").addEventListener("input", function () {
                fontColor = this.value;
            });

            document.getElementById("fontStyleInput").addEventListener("change", function () {
                setFontStyle();
            });

            setFontStyle(); // set default font style

            // When the window is resized, clear the canvas and redraw the image and text
            window.addEventListener("resize", function () {
                if (img && text) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    merge();
                }
            });
        }
    </script>
</div>
</main>